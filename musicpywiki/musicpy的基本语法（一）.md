# musicpy的基本语法（一）

## 目录
- [音符类型的基本语法](#音符类型的基本语法)
  - [使用音名和八度数构建一个音符](#使用音名和八度数构建一个音符)
  - [直接输入音符名（音名+八度数）构建一个音符](#直接输入音符名音名八度数构建一个音符)
  - [对已有音符进行音符长度和音量的设置](#对已有音符进行音符长度和音量的设置)
  - [音符的音高数转换成音符类型，以及从音符类型得到音高数](#音符的音高数转换成音符类型以及从音符类型得到音高数)
  - [音符的升降音](#音符的升降音)
  - [音符的升号与降号互相转换](#音符的升号与降号互相转换)
  - [多个音符连接组合成和弦](#多个音符连接组合成和弦)
- [和弦类型的基本语法](#和弦类型的基本语法)
  - [对一个和弦进行音符间隔和音符长度的设置](#对一个和弦进行音符间隔和音符长度的设置)
  - [根据和弦根音与和弦名获得一个和弦](#根据和弦根音与和弦名获得一个和弦)
  - [输入音符名称，音符长度和音符间距构建和弦](#输入音符名称音符长度和音符间距构建和弦)
  - [和弦的表示](#和弦的表示)
  - [获得和弦的转位](#获得和弦的转位)
  - [两个和弦的拼接](#两个和弦的拼接)
  - [往一个和弦添加音符](#往一个和弦添加音符)
  - [去掉一个和弦的某一个音](#去掉一个和弦的某一个音)
  - [重复一个和弦一定的次数](#重复一个和弦一定的次数)
  - [对一个和弦进行倒序排列](#对一个和弦进行倒序排列)
  - [获得一个和弦的音程关系](#获得一个和弦的音程关系)
  - [对一个和弦进行索引，切片（通过索引值得到一个和弦的某一个音，或者某一个范围内的片段）](#对一个和弦进行索引切片通过索引值得到一个和弦的某一个音或者某一个范围内的片段)
  - [播放一个和弦，一个音符，或者任意一段musicpy语言代码](#播放一个和弦一个音符或者任意一段musicpy语言代码)
  - [对一个和弦进行升调和降调（升降音）](#对一个和弦进行升调和降调升降音)
  - [对一个和弦进行排序](#对一个和弦进行排序)
  - [对一个和弦（或者一首曲子）进行转调](#对一个和弦或者一首曲子进行转调)

# 音符类型的基本语法

## 使用音名和八度数构建一个音符
```python
a = note('D', 6)
```
a为音符D6。
note的其他参数还有duration（音符长度，以小节为单位），volume（音符力度，对应midi的0~127,也就是0到127之间的任意整数(包括0和127)）
比如
```python
a = note('C', 5, 0.5, 100)
```
表示a为音符C5，音符长度为0.5个小节，音符力度为100。

## 直接输入音符名（音名+八度数）构建一个音符
我们可以使用toNote函数
```python
toNote('E5')
```
得到的是音符E5。

toNote函数的简写方法：
```python
N('E5')
```
N表示的是音符note的首字母大写

## 对已有音符进行音符长度和音量的设置
```python
a.set(duration, volume) # 返回的是一个全新的和弦类型
a % (duration, volume) # 进阶写法
a = a % (duration, volume) # 如果想要直接替换原来的音符类型就这样写，也可以直接单独使用
```
duration为音符长度，以小节为单位，volume为音符力度，对应midi的0~127，0到127之间的任意整数(包括0和127)，可以只设置其中一个，（不设置的放空即可）也可以同时设置两个参数。

使用音符类型的内置函数set返回的是一个全新的参数经过修改后的音符类型，与之前的音符类型完全独立开来，这样设计是因为再具体写musicpy代码的时候，可以搭积木式地一句话写好音乐语句的音高，音符间隔，音符长度，音量大小等参数，这也是我对于musicpy的语法设计的要求之一。其他的乐理类型，比如和弦类型的set方法也和这里是一个道理，之后讲到和弦类型的时候会为大家详细说明。

## 音符的音高数转换成音符类型，以及从音符类型得到音高数
使用degree_to_note函数可以把一个整数转换成对应的音符，比如
```python
degree_to_note(60)
```
得到的是音符类型C5。


得到一个音符类型a的音高数，只需要
```python
a.degree
```
即可


## 音符的升降音
```python
a.up(n)
```
表示升高a音符n个半音
```python
a.down(n)
```
表示降低a音符n个半音

进阶写法：
```python
+++a  #(音符a升三个半音)
---a  #(音符a降三个半音)
a + n  #(音符a升n个半音)
a - n  #(音符a降n个半音)
```
(可以类比和弦类的升降音)

## 音符的升号与降号互相转换
比如音符a的音名是C#，那么
```python
~a
```
得到的是音符a的降号表示
```python
Db
```
比如音符b的音名是Eb，那么
```python
~b
```
得到的是音符b的升号表示
```python
D#
```


## 多个音符连接组合成和弦
比如现在有a, b, c, d四个音符，那么可以用+号把这些音符连接起来，组成一个音符依次为a, b, c, d的和弦，
```python
A = a + b + c + d
```
和弦A的组成音依次为a, b, c, d

那么这时候有人可能会问，用+号把多个音符连接起来之后获得的和弦，如何设置音符间隔呢？（音符长度是每个音符自己就有的属性了）
下面我会说如何对一个和弦进行音符间隔和音符长度的设置。


# 和弦类型的基本语法

## 对一个和弦进行音符间隔和音符长度的设置
比如现在有一个和弦A，想要设置其音符间隔都为1个小节，音符长度都为1.5个小节，那么可以使用和弦类的内置方法set，set的第一个参数是音符长度duration，第二个参数是音符间隔interval
```python
A.set(1.5, 1)
```
得到的是和弦A的音符长度全部设置为1.5，音符间隔全部设置为1的全新的和弦类型，请注意不是修改和弦A的内部属性，而是直接返回一个全新的和弦，这个和弦的内部属性为和弦A修改过后的值。如果对于每个音的音符长度或者每个音符间隔都有不同的设定，那么可以传一个列表进去，比如
```python
A.set([0.5, 0.5, 1, 1], [1, 1, 2, 2])
```
返回的是一个音符长度分别为0.5, 0.5, 1, 1 (单位为小节)，音符间隔分别为1, 1, 2, 2 (单位为小节)的和弦。

进阶写法：
```python
A % (1.5, 1)
```

## 根据和弦根音与和弦名获得一个和弦

介绍一个很方便的函数：getchord，这个函数可以让你得到你想要的类型的和弦，只需给定和弦的根音和和弦类型即可。由于这个函数的名字相对有点长，所以用chd这个名字（chord的缩写）也可以调用getchord。比如：
```python
Am7 = chd('A', 'm7')
```
这样我们就创建了一个A的小七和弦。其表示为
```python
[A5, C6, E6, G6] with interval [0, 0, 0, 0]
```
和弦类型的种类很多，具体可以到database.py这个文件里面的chordTypes查看，用户还可以自己添加自己喜欢的和弦种类，只需按照chordTypes里相同的格式，写上和弦名称和对应的和弦音程即可。
chd函数的第一个参数和弦的根音，如果不指定具体的音高（比如C5，D6这种是一个有具体音高的音符），则默认按照第4个八度来看待，比如chd('A', 'm7')，等价于
chd('A4', 'm7'), 如果指定根音具体的音高，比如现在想写根音为D6的大七和弦，则可以写：
```python
Dmaj7 = chd('D6', 'maj7')
```
此外，chd函数还有非常多的参数，可以用来设置和弦的省略音，升降音，外加的音，以及和弦的每个音符具体的长度，音符的间隔等等，您甚至可以输入音符的音程来构建和弦（也可以通过设定cummulative的值来决定是要输入每个音符到根音的音程还是每两个音符之间的音程），在musicpy里，每个音程的名字已经定义好了，可以直接用，比如major_third的值为4，也就是大三度的半音数。

比如按照音程的关系构建一个C大七和弦，可以这么写：
```python
chd('C', interval=[major_third, perfect_fifth, major_seventh])
```
得到的是
```python
[C5, E5, G5, B5] with interval [0, 0, 0, 0]
```
当一个和弦的interval全部为0的时候，这个和弦就是所有音符一起同时演奏。如果某个interval为0，表示的是两个音同时一起开始弹。

## 输入音符名称，音符长度和音符间距构建和弦

比如我们想构建一个大七和弦，根音为C5，音符间距为每个音都相差一个小节，每个音符的长度都为两个小节，那么可以这么写：
```python
chord(['C5','E5', 'G5', 'B5'], interval=1, duration=2)
```

如果音符间距和音符长度不是一样的，那么可以传一个列表进去，比如：

```python
chord(['C5','E5', 'G5', 'B5'], interval=[0.5, 0.5, 0, 2], duration=[1, 2, 0.5, 1])
```


## 和弦的表示

在musicpy里，一个和弦类型的表示为：
```python
[音符1, 音符2, 音符3, ...] with interval [间隔1, 间隔2, 间隔3, ...]
```
比如A是一个C大七和弦，根音为C5，
```python
A = chd('C5', 'maj7')
```
和弦A的表示为
```python
[C5, E5, G5, B5] with interval [0, 0, 0, 0]
```


## 获得和弦的转位

inversion可以得到一个和弦的转位，里面有一个参数num代表和弦的第几转位。比如：
```python
chd('A', 'm7').inversion(1) 
```
可以得到A的小七和弦的第一转位，表示出来是这样的：
```python
[C6, E6, G6, A6] with interval [0, 0, 0, 0]
```
进阶写法：（我为musicpy的很多功能都设计了符号化的写法，写起来更快）
```python
chd('A', 'm7') / 1
```
结果和chd('A', 'm7').inversion(1)是一样的。
也可以在'/'后面写想要转位的音符，如果音符在和弦内则会把那个音符转位到最低音，比如
```python
chd('A', 'm7') / 'E'
```
得到的结果是
```python
[E6, G6, A6, C7] with interval [0, 0, 0, 0]
```
也就是A小七和弦的第二转位。


## 两个和弦的拼接

如果想对两个和弦（比如a和b）进行拼接，那么只需要
```python
a + b
```
即可。得到的是拼接之后的新的和弦。

## 往一个和弦添加音符

如果想对和弦A添加一个音符x，那么只需要
```python
A + x
```
即可。得到的是一个添加了音符x的新的和弦。

## 去掉一个和弦的某一个音

如果想去掉和弦A里面的某一个音x，那么只需要
```python
A - x
```
即可。得到的是一个去掉了音符x的新的和弦。

## 重复一个和弦一定的次数

如果想重复一个和弦A重复n次，那么只需要
```python
A * n
```
即可。得到的是重复n次的新的和弦。

请注意，如果和弦A是intervals全部为0的和弦（全部的音同时开始一起弹），那么A * n会让重复的A的音符重叠在一起，在这种情况下，如果想要让多次和弦A的重复不重叠，那么需要写
```python
A % n
```
这个语法会让A在不与前一个和弦重叠的情况下进行重复。


## 对一个和弦进行倒序排列

如果想把一个和弦A里面的音符倒序排列，那么只需要
```python
A.reverse()
```
即可。得到的是倒序过后的新的和弦。

进阶写法：
```python
~A
```
也可以得到和弦A的倒序排列。

```python
'''
注意这里的和弦A不一定只是乐理上的一个和弦，而是可以是一段旋律，甚至是一段旋律加上一段和弦铺底。因为musicpy里的和弦类定义就是“一串音符的集合”。因此，在musicpy里的一个和弦类的实例是可以存储一整首曲子的信息的，这些信息包括曲子里所有的音符，每个音符的长度，力度，以及每两个音符之间的间隔。
'''
```

## 获得一个和弦的音程关系
intervalof函数可以返回一个和弦的构成音之间的音程关系。参数cummulative设为True的时候返回和弦所有的的构成音（除根音外）和根音之间的音程，设为False的时候返回和弦从最低音到最高音两两之间的音程关系。默认值为True。比如：

```python
chd('C','maj').intervalof()
```

会得到 [4,7]，这个表示C大三和弦（C,E,G）里面第二个音到根音之间有四个半音（大三度），第三个音到根音之间有7个半音（纯五度）。如果你想看音程在乐理上的名称，那么可以设参数translate为True，那么你就可以看到对应的音程名称了。比如：
```python
chd('C','maj').intervalof(translate = True)
```
会得到 ['major third', 'perfect fifth']，也就是大三度和纯五度。

当cummulative设置为False的时候返回和弦从低到高每两个音符之间的音程，比如：

```python
chd('C','maj').intervalof(translate = True, cummulative=False)
```

会得到['major third', 'minor third']，也就是C大三和弦是由一个大三度和一个小三度构成的。

## 对一个和弦进行索引，切片（通过索引值得到一个和弦的某一个音，或者某一个范围内的片段）
比如现在我们有一个和弦A，
```python
A = chd('C', 'maj7')
```
如果我们想得到和弦A的第1个音，那么就写：
```python
A[0]
```
如果我们想得到和弦A的第2个音，那么就写：
```python
A[1]
```
如果我们想得到和弦A的最后一个音，那么就写：
```python
A[-1]
# 请注意和弦的索引值是从0开始作为第1个音的，也就是0对应和弦的第1个音，1对应和弦的第2个音，以此类推。
# 如果要得到和弦的倒数第一个音，索引值为-1，倒数第二个音为-2，以此类推。
```
如果想对一个和弦/一段旋律/一首曲子A截取其中的一部分，那么只需要A
```python
[开始位置:结束位置]
```
即可。得到的是一个新的和弦，里面的音符为截取的部分。

比如和弦B有6个音，如果要得到和弦B的前5个音，那么可以写：
```python
B[:5]
# 结束位置5是不包括在内的，所以对应的就是B的第1,2,3,4,5个音
```

如果要得到和弦B的第2个到第5个音，那么可以写：
```python
B[1:5]
# 请注意这里是左闭右开的，也就是结束位置5是不包括在结果内的，所以B[1:5]是提取B的第2个音到第5个音，总共4个音。
```

如果要得到和弦B的第2个音及往后的所有的音，那么可以写：
```python
B[1:]
```

如果要得到和弦B的倒数第3个音到倒数第1个音，那么可以写：
```python
B[-3:]
```


## 播放一个和弦，一个音符，或者任意一段musicpy语言代码

musicpy里面有一个函数叫做`play`, `play`函数可以播放任何符合musicpy正确语法的语句，并且同时生成midi文件。
`play`函数的第一个参数是结果为musicpy数据结构的语句，之后几个比较重要的关键字参数是`bpm` (速度), `name` (midi文件的名字), `instrument` (乐器类型)。
其他的参数可以参考`write`函数的参数，我在后面的文档中会讲到。

**注意：在某些IDE中(比如VS Code)这个播放函数可能会无法发出声音，这是因为程序在播放开始之前就提前退出的原因，你可以将`play`函数中的`wait`参数设置为True,这样可以让程序在保证播放完成之前等待，就可以听到声音了。**
* ### 播放音符
```python
a = note('A', 5)
play(a)
```
运行就可以听到音符A5的钢琴声音了。
```python
# 在某些IDE里需要设置`wait`参数为True才可以听到声音
a = note('A', 5)
play(a, wait=True)
```

* ### 播放和弦
```python
b = chd('C', 'maj7', intervals=1, duration=2)
play(b, 150)
```
以150的BPM播放一个C大七和弦的分解和弦。

* ### 播放任意一段musicpy语言代码
只要是符合musicpy语法的代码，得到的结果只要是音符类型或者和弦类型，就可以进行播放，比如：
```python
c = chd('D', 'm7', intervals=1)*2 + chd('E', 'maj9', intervals=0.5).reverse()
play(c, 100)
```
以100的BPM播放D小七和弦两遍（每个音符间距都为1个小节），然后E大九和弦倒着弹下来（每个音符间距都为0.5个小节）。
还有很多很多语法没讲，所以这里举的例子只能先拿我们讲过的来演示。

* ### 选择乐器类型
play函数里的instrument参数是乐器名，默认值为None，对应的是General Midi的乐器列表，除了输入乐器名，也可以直接输入乐器编号(0~127之间的任意整数)，比如
```python
play(c, 100, instrument='Violin')
```
会以小提琴的midi音色演奏跟之前同样的内容。

* ### play函数的运行机制
运行play函数的时候，会在musicpy的文件夹里自动生成一个midi文件，里面的内容就是play函数接收的musicpy代码所对应的音乐。

实际上play函数的机制就是把musicpy代码对应的音乐的内容写入一个新的midi文件，然后调用pygame的函数播放midi文件（之前是调用本地播放器，最近改进为直接在内部用pygame播放，无需调用本地播放器）。

这个生成的midi文件也方便大家之后继续放在编曲软件里进行观看和使用。

此外，任何一个音符与和弦类型也可以调用自己的play函数进行播放，比如播放和弦A，可以写：
```python
A.play(150)
```
以150的BPM播放和弦A

## 对一个和弦进行升调和降调（升降音）
如果你想对一个和弦（当然也可能是一段旋律或者音乐片段）升调或者降调，那么可以用up和down函数。给定一个和弦A，
```python
A.up(x)
```
表示把和弦A整体升高x个半音（x也可以是负数，表示降低x的绝对值个半音），
```python
A.down(x)
```
表示把和弦A整体降低x个半音。

进阶写法：
```python
+A
```
表示把和弦A整体升高一个半音，有多少个加号就是升多少个半音，比如
```python
+++A
```
表示把和弦A整体升高三个半音，但是由于每一个加号和弦A都会重新被覆盖，(等价于A.up().up().up())

所以我还设计了一个一步到位的写法：
```python
A + 3
```
表示把和弦A整体升高三个半音，等价于A.up(3),
```python
-A
```
表示把和弦A整体降低一个半音，有多少个减号就是升多少个半音，比如
```python
---A
```
表示把和弦A整体降低三个半音，等价于A.down().down().down()
```python
A - 3
```
表示把和弦A整体降低三个半音，等价于A.down(3)

如果你只想把和弦里的某个音升高，那么只需要
```python
A.up(x, k)
```
或者
```python
A + (x, k)
```
降低则是
```python
A.down(x, k)
```
或者
```python
A - (x, k)
```
其中k表示第几个音。比如
```python
chd('C','maj').up(1)
```
会得到一个新的和弦，里面每个音都比之前的和弦升高一个半音，
构成音为C#, F, G#。
```python
chd('C','maj').up(1,0)
```
会得到一个新的和弦，只有第一个音升高一个半音，构成音为C#, E, G。

如果要对每个音进行不同的升降，那么可以让x等于一个列表，列表里每个元素都是升降的半音数，
比如：
```python
A.up([1,2,0,-1])
```
或者
```python
A + [1,2,0,-1]
```
表示把和弦A的前四个音分别升高一个半音，升高两个半音，不变，降低一个半音。
down的情况以此类推。

## 对一个和弦进行排序
如果你想对一个和弦A的组成音进行排序，那么只需要
```python
A.sort(x)
```
其中x为一个记载顺序的列表，
比如有一个A的小七和弦，对于它的4个组成音A,C,E,G你想按照CEAG的顺序排列，那么就写
```python
A.sort([2, 3, 1, 4])
```
即可。

进阶写法：
```python
A / [2, 3, 1, 4]
```
等价于A.sort([2, 3, 1, 4])

## 对一个和弦（或者一首曲子）进行转调
如果你想对一段旋律（包括和弦铺底）进行转调，那么可以使用modulation函数。比如现在想给一个音乐片段A转调，那么就可以
```python
A.moulation(之前的调, 要转向的调)
```
关于如何表示一个调式，这个接下来会谈。
比如现在有一个音乐片段p是A大调，现在想转到A小调，那么就可以写:
```python
p.modulation(scale('A', 'major'), scale('A', 'minor'))
```
这样就把音乐片段p从A大调转到A小调啦~

## 下一章 [musicpy的基本语法（二）](https://github.com/Rainbow-Dreamer/musicpy/wiki/musicpy的基本语法（二）)

